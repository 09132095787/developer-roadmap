import{j as s}from"./jsx-runtime.6940b965.js";import{r as i}from"./index.070054a4.js";import{r as E}from"./renderer.2494036d.js";import{r as b,u as j,a as C,b as L}from"./resource-progress.9335d95d.js";import{p as y}from"./page.c1a8a472.js";import{u as S}from"./use-toast.fb52de5d.js";import{c as I}from"./createLucideIcon.3c9fdece.js";const N=I("CircleSlash",[["line",{x1:"9",x2:"15",y1:"15",y2:"9",key:"1dfufj"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),T=i.forwardRef((c,t)=>{const{roadmap:e,onRendered:n}=c;return i.useEffect(()=>{(async()=>{const u=document.getElementById("resource-svg-wrap");if(!u)return;const p=await E(e);u?.replaceChildren(p),n?.()})()},[e]),s.jsx("div",{ref:t,id:"resource-svg-wrap"})});function D(c){const{roadmapId:t,canManage:e}=c,n=`https://draw.roadmap.sh/${t}`;return s.jsx("div",{className:"flex h-full items-center justify-center",children:s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(N,{className:"mx-auto h-20 w-20 text-gray-400"}),s.jsx("h3",{className:"mt-2",children:"This roadmap is currently empty."}),e&&s.jsx("a",{href:n,className:"mt-4 rounded-lg bg-black px-4 py-2 font-medium text-white hover:bg-gray-900",children:"Edit Roadmap"})]})})}function k(c){const t=c?.closest("g")||{},e=t?.dataset?.nodeId,n=t?.dataset?.type;return!e||!n?null:{nodeId:e,nodeType:n,targetGroup:t}}const v=["topic","subtopic","button","link-item"];function B(c){const{roadmap:t}=c,e=i.useRef(null),n=t._id,u=S(),[p,R]=i.useState(!1);async function m(r,d){y.set("Updating progress"),j({resourceId:n,resourceType:"roadmap",topicId:r},d).then(()=>{C(r,d)}).catch(a=>{u.error("Something went wrong, please try again."),console.error(a)}).finally(()=>{y.set(""),L()})}const h=i.useCallback(r=>{const d=r.target,{nodeId:a,nodeType:o,targetGroup:l}=k(d)||{};if(!a||!o||!v.includes(o))return;if(o==="button"||o==="link-item"){const f=l?.dataset?.link||"";f.startsWith("http")?window.open(f,"_blank"):window.location.href=f;return}const g=l?.classList.contains("learning"),w=l?.classList.contains("skipped");if(r.shiftKey){r.preventDefault(),m(a,g?"pending":"learning");return}else if(r.altKey){r.preventDefault(),m(a,w?"pending":"skipped");return}window.dispatchEvent(new CustomEvent("roadmap.node.click",{detail:{topicId:a,resourceId:t?._id,resourceType:"roadmap",isCustomResource:!0}}))},[]),x=i.useCallback(r=>{r.preventDefault();const d=r.target,{nodeId:a,nodeType:o,targetGroup:l}=k(d)||{};if(!a||!o||!v.includes(o)||o==="button"||o==="link-item")return;const g=l?.classList.contains("done");m(a,g?"pending":"done")},[]);return i.useEffect(()=>{if(e?.current)return e?.current?.addEventListener("click",h),e?.current?.addEventListener("contextmenu",x),()=>{e?.current?.removeEventListener("click",h),e?.current?.removeEventListener("contextmenu",x)}},[]),s.jsx("div",{className:"flex grow bg-gray-50 pb-8 pt-4 sm:pt-12",children:s.jsxs("div",{className:"container !max-w-[1000px]",children:[s.jsx(T,{ref:e,roadmap:{nodes:t?.nodes,edges:t?.edges},onRendered:()=>{b("roadmap",n).then(()=>{t?.nodes?.length===0&&(R(!0),e?.current?.classList.add("hidden"))})}}),p&&s.jsx(D,{roadmapId:n,canManage:t.canManage})]})})}export{B as R,v as a,k as g};
