import{j as n}from"./jsx-runtime.6940b965.js";import{r as d}from"./index.070054a4.js";import{a as E,T as R}from"./jwt.5556697d.js";import{S as v}from"./spinner.2dd3a98d.js";import{a as u}from"./http.3e3d4bea.js";const L=new Proxy({src:"/_astro/linkedin.f7c52848.svg",width:100,height:100,format:"svg"},{get(r,o,e){return o==="clone"?structuredClone(r):(globalThis.astroAsset.referencedImages.add(r.fsPath),r[o])}}),m="linkedInRedirectAt",g="linkedInLastPage";function y(r){const[o,e]=d.useState(!1),[h,a]=d.useState(""),I=o?v:L;d.useEffect(()=>{const t=new URLSearchParams(window.location.search),i=t.get("code"),s=t.get("state"),k=t.get("provider");!i||!s||k!=="linkedin"||(e(!0),u(`https://api.roadmap.sh/v1-linkedin-callback${window.location.search}`).then(({response:c,error:x})=>{if(!c?.token){a(x?.message||"Something went wrong."),e(!1);return}let l="/";const f=localStorage.getItem(m),w=localStorage.getItem(g);if(f&&w){const b=parseInt(f,10);Date.now()-b<30*1e3&&(l=w)}const p=localStorage.getItem("authRedirect");p&&(localStorage.removeItem("authRedirect"),l=p),localStorage.removeItem(m),localStorage.removeItem(g),E.set(R,c.token,{path:"/",expires:30,domain:".roadmap.sh"}),window.location.href=l}).catch(c=>{a("Something went wrong. Please try again later."),e(!1)}))},[]);const S=()=>{e(!0),u("https://api.roadmap.sh/v1-linkedin-login").then(({response:t,error:i})=>{if(!t?.loginUrl){a(i?.message||"Something went wrong."),e(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const s=["/respond-invite","/befriend"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(m,Date.now().toString()),localStorage.setItem(g,s)}window.location.href=t.loginUrl}).catch(t=>{a("Something went wrong. Please try again later."),e(!1)})};return n.jsxs(n.Fragment,{children:[n.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:o,onClick:S,children:[n.jsx("img",{src:I.src,alt:"Google",className:`h-[18px] w-[18px] ${o?"animate-spin":""}`}),"Continue with LinkedIn"]}),h&&n.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:h})]})}export{y as LinkedInButton};
