import{j as r}from"./jsx-runtime.6940b965.js";import{r as g}from"./index.070054a4.js";import{a as R,T as v}from"./jwt.5556697d.js";import{S as G}from"./spinner.2dd3a98d.js";import{a as u}from"./http.3e3d4bea.js";const P=new Proxy({src:"/_astro/google.b1c95028.svg",width:90,height:92,format:"svg"},{get(a,o,e){return o==="clone"?structuredClone(a):(globalThis.astroAsset.referencedImages.add(a.fsPath),a[o])}}),m="googleRedirectAt",d="googleLastPage";function C(a){const[o,e]=g.useState(!1),[h,n]=g.useState(""),S=o?G:P;g.useEffect(()=>{const t=new URLSearchParams(window.location.search),i=t.get("code"),s=t.get("state"),I=t.get("provider");!i||!s||I!=="google"||(e(!0),u(`https://api.roadmap.sh/v1-google-callback${window.location.search}`).then(({response:c,error:b})=>{if(!c?.token){n(b?.message||"Something went wrong."),e(!1);return}let l="/";const f=localStorage.getItem(m),w=localStorage.getItem(d);if(f&&w){const E=parseInt(f,10);Date.now()-E<30*1e3&&(l=w)}const p=localStorage.getItem("authRedirect");p&&(localStorage.removeItem("authRedirect"),l=p),localStorage.removeItem(m),localStorage.removeItem(d),R.set(v,c.token,{path:"/",expires:30,domain:".roadmap.sh"}),window.location.href=l}).catch(c=>{n("Something went wrong. Please try again later."),e(!1)}))},[]);const x=()=>{e(!0),u("https://api.roadmap.sh/v1-google-login").then(({response:t,error:i})=>{if(!t?.loginUrl){n(i?.message||"Something went wrong."),e(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const s=["/respond-invite","/befriend"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(m,Date.now().toString()),localStorage.setItem(d,s)}window.location.href=t.loginUrl}).catch(t=>{n("Something went wrong. Please try again later."),e(!1)})};return r.jsxs(r.Fragment,{children:[r.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:o,onClick:x,children:[r.jsx("img",{src:S.src,alt:"Google",className:`h-[18px] w-[18px] ${o?"animate-spin":""}`}),"Continue with Google"]}),h&&r.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:h})]})}export{C as GoogleButton};
