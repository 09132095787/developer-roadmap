import{j as r}from"./jsx-runtime.6940b965.js";import{r as d}from"./index.070054a4.js";import{S as v}from"./spinner.2dd3a98d.js";import{a as E,T as P}from"./jwt.ab9b7b25.js";import{a as b}from"./http.408ee04f.js";const G=new Proxy({src:"/_astro/github.ab5c33e4.svg",width:98,height:96,format:"svg"},{get(a,e,t){return e==="clone"?structuredClone(a):(globalThis.astroAsset.referencedImages.add(a.fsPath),a[e])}}),g="githubRedirectAt",u="githubLastPage";function y(a){const[e,t]=d.useState(!1),[h,i]=d.useState(""),S=e?v:G;d.useEffect(()=>{const o=new URLSearchParams(window.location.search),n=o.get("code"),s=o.get("state"),I=o.get("provider");!n||!s||I!=="github"||(t(!0),b(`https://api.roadmap.sh/v1-github-callback${window.location.search}`).then(({response:c,error:R})=>{if(!c?.token){const m=R?.message||"Something went wrong.";i(m),t(!1);return}let l="/";const p=localStorage.getItem(g),f=localStorage.getItem(u);if(p&&f){const m=parseInt(p,10);Date.now()-m<30*1e3&&(l=f)}const w=localStorage.getItem("authRedirect");w&&(localStorage.removeItem("authRedirect"),l=w),localStorage.removeItem(g),localStorage.removeItem(u),E.set(P,c.token,{path:"/",expires:30,domain:".roadmap.sh"}),window.location.href=l}).catch(c=>{i("Something went wrong. Please try again later."),t(!1)}))},[]);const x=async()=>{t(!0);const{response:o,error:n}=await b("https://api.roadmap.sh/v1-github-login");if(n||!o?.loginUrl){i(n?.message||"Something went wrong. Please try again later."),t(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const s=["/respond-invite","/befriend"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(g,Date.now().toString()),localStorage.setItem(u,s)}window.location.href=o.loginUrl};return r.jsxs(r.Fragment,{children:[r.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:e,onClick:x,children:[r.jsx("img",{src:S.src,alt:"GitHub",className:`h-[18px] w-[18px] ${e?"animate-spin":""}`}),"Continue with GitHub"]}),h&&r.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:h})]})}export{y as GitHubButton};
