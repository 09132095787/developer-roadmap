import{a as r}from"./index.CEvxOxeV.js";const m=5,a=6,d=10;let p=(n,u,i,f)=>(n.events=n.events||{},n.events[i+d]||(n.events[i+d]=f(e=>{n.events[i].reduceRight((l,t)=>(t(l),l),{shared:{},...e})})),n.events[i]=n.events[i]||[],n.events[i].push(u),()=>{let e=n.events[i],l=e.indexOf(u);e.splice(l,1),e.length||(delete n.events[i],n.events[i+d](),delete n.events[i+d])}),v=1e3,T=(n,u)=>p(n,f=>{let e=u(f);e&&n.events[a].push(e)},m,f=>{let e=n.listen;n.listen=(...t)=>(!n.lc&&!n.active&&(n.active=!0,f()),e(...t));let l=n.off;return n.events[a]=[],n.off=()=>{l(),setTimeout(()=>{if(n.active&&!n.lc){n.active=!1;for(let t of n.events[a])t();n.events[a]=[]}},v)},()=>{n.listen=e,n.off=l}}),O=(n,u)=>{Array.isArray(n)||(n=[n]);let i,f=()=>{let l=n.map(t=>t.get());(i===void 0||l.some((t,s)=>t!==i[s]))&&(i=l,e.set(u(...l)))},e=r(void 0,Math.max(...n.map(l=>l.l))+1);return T(e,()=>{let l=n.map(t=>t.listen(f,e.l));return f(),()=>{for(let t of l)t()}}),e};export{O as c};
