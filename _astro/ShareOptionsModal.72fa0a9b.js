import{c as j}from"./createLucideIcon.3c9fdece.js";import{j as e}from"./jsx-runtime.6940b965.js";import{r as h}from"./index.070054a4.js";import{u as L}from"./use-toast.fb52de5d.js";import{c as y}from"./classname.585fc13a.js";import{a as A,b as R}from"./http.387f5009.js";import{U as q}from"./users.9673a18c.js";import{u as ee}from"./use-copy-text.77785bb1.js";import{C as se}from"./check-circle.045c0bed.js";import{C as ae}from"./copy.2caf0f52.js";import{M as H,L as Y}from"./roadmap.9fae4e3a.js";const te=j("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]),re=j("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),z=j("Globe2",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),W=j("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),we=j("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Ne=j("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),V=j("Users2",[["path",{d:"M14 19a6 6 0 0 0-12 0",key:"vej9p1"}],["circle",{cx:"8",cy:"9",r:"4",key:"143rtg"}],["path",{d:"M22 19a6 6 0 0 0-6-6 4 4 0 1 0 0-8",key:"hqbn22"}]]);function J(m){const{user:s,onClick:t,isSelected:l}=m;return e.jsxs("button",{className:y("relative flex w-full items-center gap-2.5 rounded-lg border p-2.5",l&&"border-gray-500 bg-gray-300 text-black"),onClick:t,children:[e.jsx("img",{src:s.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${s.avatar}`:"/images/default-avatar.png",alt:s.name||"",className:"relative top-[1px] h-10 w-10 shrink-0 rounded-full"}),e.jsxs("div",{className:"inline-grid w-full",children:[e.jsx("h3",{className:"truncate text-left font-semibold",children:s.name}),e.jsx("p",{className:y("truncate text-left text-sm text-gray-500",l&&"text-gray-700"),children:s.email})]})]})}function le(m){const{setFriends:s,friends:t,sharedFriendIds:l,setSharedFriendIds:r}=m,o=L(),[a,g]=h.useState(!0);async function p(){if(t.length>0)return;g(!0);const{response:i,error:c}=await A("https://api.roadmap.sh/v1-list-friends");if(c||!i){o.error(c?.message||"Something went wrong");return}s(i.filter(d=>d.status==="accepted"))}h.useEffect(()=>{p().finally(()=>{g(!1)})},[]);const x=a&&e.jsx("ul",{className:"mt-2 grid grid-cols-3 gap-1.5",children:[...Array(3)].map((i,c)=>e.jsxs("li",{className:"flex animate-pulse items-center gap-2.5 rounded-md border p-2",children:[e.jsx("div",{className:"relative top-[1px] h-10 w-10 shrink-0 rounded-full bg-gray-200"}),e.jsxs("div",{className:"inline-grid w-full",children:[e.jsx("div",{className:"h-5 w-2/4 rounded bg-gray-200"}),e.jsx("div",{className:"mt-1 h-5 w-3/4 rounded bg-gray-200"})]})]},c))});return e.jsxs(e.Fragment,{children:[(t.length>0||a)&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm",children:"Select Friends to share the roadmap with"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:l.length===t.length,onChange:i=>{i.target.checked?r(t.map(c=>c.userId)):r([])}}),e.jsx("span",{className:"text-sm",children:"Select all"})]})]}),x,t.length>0&&!a&&e.jsx("ul",{className:"mt-2 grid grid-cols-3 gap-1.5",children:t.map(i=>{const c=l?.includes(i.userId);return e.jsx("li",{children:e.jsx(J,{user:{name:i.name,avatar:i.avatar,email:i.email},isSelected:c,onClick:()=>{r(c?l.filter(d=>d!==i.userId):[...l,i.userId])}})},i.userId)})}),t.length===0&&!a&&e.jsxs("div",{className:"flex h-full flex-grow flex-col items-center justify-center rounded-md border bg-gray-50 text-center",children:[e.jsx(V,{className:"mb-3 h-10 w-10 text-gray-300"}),e.jsxs("p",{className:"font-semibold text-gray-500",children:["You do not have any friends yet. ",e.jsx("br",{})," ",e.jsx("a",{target:"_blank",className:"underline underline-offset-2",href:`${{}.PUBLIC_ROADMAP_WEB_URL}/account/friends`,children:"Invite your friends to share roadmaps with."})]})]})]})}function ne(m){const{teams:s,setTeams:t,selectedTeamId:l,setSelectedTeamId:r,isTeamMembersLoading:o,setIsTeamMembersLoading:a,onTeamChange:g}=m,p=L(),[x,i]=h.useState(!0);async function c(){if(s.length>0)return;const{response:n,error:u}=await A("https://api.roadmap.sh/v1-get-user-teams");if(u||!n){p.error(u?.message||"Something went wrong");return}t(n.filter(F=>["admin","manager"].includes(F.role)))}h.useEffect(()=>{c().finally(()=>i(!1))},[]);const d=x&&e.jsx("ul",{className:"mt-2 grid grid-cols-3 gap-1.5",children:[...Array(3)].map((n,u)=>e.jsx("li",{children:e.jsxs("div",{className:"relative flex w-full items-center gap-2 rounded-md border p-2",children:[e.jsx("div",{className:"h-6 w-6 shrink-0 animate-pulse rounded-full bg-gray-200"}),e.jsx("div",{className:"inline-grid w-full",children:e.jsx("div",{className:"h-4 animate-pulse rounded bg-gray-200"})})]})},u))});return e.jsxs(e.Fragment,{children:[(s.length>0||x)&&e.jsx("p",{className:"text-sm",children:"Select a team to transfer this roadmap to"}),d,s.length>0&&!x&&e.jsx("ul",{className:"mt-2 grid grid-cols-3 gap-1.5",children:s.map(n=>{const u=n._id===l;return e.jsx("li",{children:e.jsxs("button",{className:y("relative flex w-full items-center gap-2.5 rounded-lg border p-2.5 disabled:cursor-not-allowed disabled:opacity-70",u&&"border-gray-500 bg-gray-100 text-black"),disabled:o,onClick:()=>{r(u?null:n._id),g(n._id)},children:[e.jsx("img",{src:n.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${n.avatar}`:"/images/default-avatar.png",alt:n.name||"",className:"h-6 w-6 shrink-0 rounded-full"}),e.jsx("div",{className:"inline-grid w-full",children:e.jsx("h3",{className:"truncate text-left font-normal",children:n.name})})]})},n._id)})}),s.length===0&&!x&&e.jsxs("div",{className:"flex grow flex-col items-center justify-center gap-2",children:[e.jsx(V,{className:"h-12 w-12 text-gray-500"}),e.jsx("p",{className:"text-gray-500",children:"You are not a member of any team."})]})]})}const ie=[{id:"me",label:"Only me",long:"Only visible to me",icon:W},{id:"public",label:"Public",long:"Anyone can view",icon:z},{id:"friends",label:"Only friends",long:"Only friends can view",icon:q},{id:"team",label:"Only Members",long:"Visible to team members",icon:V}];function de(m){const{visibility:s,setVisibility:t,teamId:l,onChange:r}=m,o=a=>{t(a),r(a)};return e.jsxs("div",{className:"flex justify-between",children:[e.jsx("ul",{className:"flex w-full items-center gap-1.5",children:ie.map(a=>{if(a.id==="friends"&&l)return null;if(a.id==="team"&&!l)return null;const g=a.id===s;return e.jsx("li",{children:e.jsx(G,{label:a.label,isActive:g,icon:a.icon,onClick:()=>{o(a.id)}})},a.id)})}),!l&&e.jsx("div",{className:"grow",children:e.jsx(G,{label:"Transfer to team",icon:te,isActive:s==="team",onClick:()=>{o("team")},className:'border-red-300 text-red-600 hover:border-red-200 hover:bg-red-50 data-[active="true"]:border-red-600 data-[active="true"]:bg-red-600 data-[active="true"]:text-white'})})]})}function G(m){const{label:s,isActive:t,onClick:l,icon:r,className:o}=m;return e.jsxs("button",{className:y("flex items-center justify-center gap-2 rounded-md border px-3 py-2 text-sm text-black hover:border-gray-300 hover:bg-gray-100",'data-[active="true"]:border-gray-500 data-[active="true"]:bg-gray-200 data-[active="true"]:text-black',o),"data-active":t,disabled:t,onClick:l,children:[!t&&e.jsx(r,{className:"h-4 w-4"}),t&&e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"whitespace-nowrap",children:s})]})}function B(m){const{teamId:s,title:t="Select Members",sharedTeamMemberIds:l,setSharedTeamMemberIds:r,membersCache:o,isTeamMembersLoading:a,setIsTeamMembersLoading:g}=m,p=L();async function x(){if(o.has(s))return;g(!0);const{response:d,error:n}=await A(`https://api.roadmap.sh/v1-get-team-member-list/${s}`);if(n||!d){p.error(n?.message||"Something went wrong");return}o.set(s,d)}h.useEffect(()=>{x().finally(()=>{g(!1)})},[s]);const i=a&&e.jsx("ul",{className:"mt-2 grid grid-cols-3 gap-2.5",children:[...Array(3)].map((d,n)=>e.jsxs("li",{className:"flex min-h-[66px] animate-pulse items-center gap-2 rounded-md border p-2",children:[e.jsx("div",{className:"h-8 w-8 shrink-0 rounded-full bg-gray-200"}),e.jsxs("div",{className:"inline-grid w-full",children:[e.jsx("div",{className:"h-5 w-2/4 rounded bg-gray-200"}),e.jsx("div",{className:"mt-1 h-5 w-3/4 rounded bg-gray-200"})]})]},n))}),c=o.get(s)||[];return e.jsxs(e.Fragment,{children:[(c.length>0||a)&&e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm",children:t}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.length===c.length,onChange:d=>{d.target.checked?r(c.map(n=>n._id)):r([])}}),e.jsx("span",{className:"text-sm",children:"Select all"})]})]}),i,c?.length>0&&!a&&e.jsx("ul",{className:"mt-2 grid grid-cols-3 gap-2.5",children:c?.map(d=>{const n=l?.includes(d._id?.toString());return e.jsx("li",{children:e.jsx(J,{user:{name:d.name,avatar:d.avatar,email:d.invitedEmail},isSelected:n,onClick:()=>{r(n?l.filter(u=>u!==d._id?.toString()):[...l,d._id?.toString()])}})},d.userId)})}),c.length===0&&!a&&e.jsxs("div",{className:"flex grow flex-col items-center justify-center gap-2",children:[e.jsx(q,{className:"h-12 w-12 text-gray-500"}),e.jsx("p",{className:"text-gray-500",children:"No members have been added yet."})]})]})}function ce(m){const{roadmapId:s,onClose:t}=m,r=`https://roadmap.sh/r?id=${s}`,{copyText:o,isCopied:a}=ee();return e.jsxs("div",{className:"flex grow flex-col justify-center",children:[e.jsxs("div",{className:"mt-5 flex grow flex-col items-center justify-center gap-1.5",children:[e.jsx(se,{className:"h-14 w-14 text-green-500"}),e.jsx("h3",{className:"text-xl font-medium",children:"Sharing Settings Updated"})]}),e.jsx("input",{type:"text",className:"mt-6 w-full rounded-md border bg-gray-50 p-2 px-2.5 text-gray-700 focus:outline-none",value:r,readOnly:!0,onClick:g=>{g.currentTarget.select(),o(r)}}),e.jsx("p",{className:"mt-1 text-sm text-gray-400",children:"You can share the above link with anyone who has access"}),e.jsxs("div",{className:"mt-4 flex flex-col items-center justify-end gap-2",children:[e.jsxs("button",{className:y("flex w-full items-center justify-center gap-1.5 rounded bg-black px-4 py-2.5 text-sm font-medium text-white hover:opacity-80",a&&"bg-green-300 text-green-800"),disabled:a,onClick:()=>{o(r)},children:[e.jsx(ae,{className:"h-3.5 w-3.5 stroke-[2.5]"}),a?"Copied":"Copy"]}),e.jsx("button",{className:y("flex w-full items-center justify-center gap-1.5 rounded border border-black px-4 py-2 text-sm font-medium hover:bg-gray-100"),onClick:t,children:"Close"})]})]})}function ve(m){const{roadmapId:s,onClose:t,visibility:l,sharedTeamMemberIds:r=[],sharedFriendIds:o=[],teamId:a,onShareSettingsUpdate:g}=m,p=L(),[x,i]=h.useState(!1),[c,d]=h.useState(!1),[n,u]=h.useState([]),[F,K]=h.useState([]),[U,k]=h.useState(!1),O=h.useMemo(()=>new Map,[]),[f,Q]=h.useState(l),[w,N]=h.useState(r),[_,S]=h.useState(o),[C,E]=h.useState(null),T=f==="team"&&!a;let I=!1;(f==="friends"&&_.length===0||T&&!C||f==="team"&&a&&w.length===0)&&(I=!0);const X=async({sharedFriendIds:b,visibility:v,sharedTeamMemberIds:M})=>{if(i(!0),v==="friends"&&b.length===0){p.error("Please select at least one friend");return}else if(v==="team"&&a&&M.length===0){p.error("Please select at least one member");return}const{response:$,error:P}=await R(`https://api.roadmap.sh/v1-update-roadmap-visibility/${s}`,{visibility:v,sharedFriendIds:b,sharedTeamMemberIds:M});if(P){p.error(P?.message||"Something went wrong, please try again");return}i(!1),d(!0),g({sharedFriendIds:b,visibility:v,sharedTeamMemberIds:M})},Z=h.useCallback(async(b,v)=>{if(!s)return;i(!0);const{response:M,error:$}=await R(`https://api.roadmap.sh/v1-transfer-roadmap/${s}`,{teamId:b,sharedTeamMemberIds:v});if($){i(!1),p.error($?.message||"Something went wrong, please try again");return}window.location.reload()},[s]);return c?e.jsx(H,{onClose:t,wrapperClassName:"max-w-lg",bodyClassName:"p-4 flex flex-col",children:e.jsx(ce,{roadmapId:s,onClose:t})}):e.jsxs(H,{onClose:()=>{x||t()},wrapperClassName:"max-w-3xl",bodyClassName:"p-4 flex flex-col min-h-[400px]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"mb-1 text-xl font-semibold",children:"Update Sharing Settings"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Pick and modify who can access this roadmap."})]}),e.jsx(de,{visibility:f,setVisibility:Q,teamId:a,onChange:b=>{E(null),["me","public"].includes(b)?(N([]),S([])):b==="friends"?S(o.length>0?o:[]):b==="team"&&a?(k(!0),N(r?.length>0?r:[]),S([])):(S([]),N([]))}}),e.jsxs("div",{className:"mt-4 flex grow flex-col",children:[f==="public"&&e.jsxs("div",{className:"flex h-full flex-grow flex-col items-center justify-center rounded-md border bg-gray-50 text-center",children:[e.jsx(z,{className:"mb-3 h-10 w-10 text-gray-300"}),e.jsx("p",{className:"font-medium text-gray-500",children:"Anyone with the link can access."})]}),f==="me"&&e.jsxs("div",{className:"flex h-full flex-grow flex-col items-center justify-center rounded-md border bg-gray-50 text-center",children:[e.jsx(W,{className:"mb-3 h-10 w-10 text-gray-300"}),e.jsx("p",{className:"font-medium text-gray-500",children:"Only you will be able to access."})]}),f==="friends"&&e.jsx(le,{friends:n,setFriends:u,sharedFriendIds:_,setSharedFriendIds:S}),f==="team"&&a&&e.jsx(B,{teamId:a,sharedTeamMemberIds:w,setSharedTeamMemberIds:N,membersCache:O,isTeamMembersLoading:U,setIsTeamMembersLoading:k}),T&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{teams:F,setTeams:K,selectedTeamId:C,setSelectedTeamId:E,isTeamMembersLoading:U,setIsTeamMembersLoading:k,onTeamChange:()=>{k(!0),N([])}}),C&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"-mx-4 my-4"}),e.jsx("div",{className:"mb-4",children:e.jsx(B,{title:"Select who can access this roadmap. You can change this later.",teamId:C,sharedTeamMemberIds:w,setSharedTeamMemberIds:N,membersCache:O,isTeamMembersLoading:U,setIsTeamMembersLoading:k})})]})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between gap-1.5",children:[e.jsx("button",{className:"flex items-center justify-center gap-1.5 rounded-md border px-3.5 py-1.5 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-75",disabled:x,onClick:t,children:"Close"}),T&&e.jsxs(D,{disabled:I||x||w.length===0,onClick:()=>{Z(C,w).then(()=>null)},children:[x&&e.jsx(Y,{className:"h-4 w-4 animate-spin"}),"Transfer"]}),!T&&e.jsxs(D,{disabled:I||x,onClick:()=>{X({visibility:f,sharedTeamMemberIds:f==="team"?w:[],sharedFriendIds:f==="friends"?_:[]})},children:[x&&e.jsx(Y,{className:"h-4 w-4 animate-spin"}),"Update Sharing Settings"]})]})]})}function D(m){const{onClick:s,disabled:t,children:l,className:r}=m;return e.jsx("button",{className:y("flex min-w-[120px] items-center justify-center gap-1.5 rounded-md border border-gray-900 bg-gray-900 px-4 py-2 text-white hover:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-75",t&&"border-gray-700 bg-gray-700 text-white hover:bg-gray-700",r),disabled:t,onClick:s,children:l})}export{W as L,we as M,ve as S,Ne as T};
