import{g as w,a as q,T as b}from"./jwt.ab9b7b25.js";import{h as C,a as x}from"./http.408ee04f.js";async function I(t){const{topicId:e,resourceType:o,resourceId:n}=t,{done:s=[]}=await f(o,n)||{};return s?.includes(e)}async function N(t){const{topicId:e,resourceType:o,resourceId:n}=t,s=await f(o,n);return s?.done?.includes(e)?"done":s?.learning?.includes(e)?"learning":s?.skipped?.includes(e)?"skipped":"pending"}async function D(t,e){const{topicId:o,resourceType:n,resourceId:s}=t,{response:r,error:c}=await C("https://api.roadmap.sh/v1-update-resource-progress",{topicId:o,resourceType:n,resourceId:s,progress:e});if(c||!r?.done||!r?.learning)throw new Error(c?.message||"Something went wrong");return $(n,s,r.done,r.learning,r.skipped),r}async function f(t,e){if(!q.get(b))return{done:[],learning:[],skipped:[]};const o=w()?.id,n=`${t}-${e}-${o}-progress`,s=`${t}-${e}-${o}-favorite`,r=localStorage.getItem(s),c=JSON.parse(r||"0")===1,a=localStorage.getItem(n),l=JSON.parse(a||"null"),g=l?.timestamp,p=new Date().getTime()-parseInt(g||"0",10)>15*60*1e3;return!l||p?_(t,e):(window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:t,resourceId:e,isFavorite:c}})),l)}async function _(t,e){const{response:o,error:n}=await x("https://api.roadmap.sh/v1-get-user-resource-progress",{resourceType:t,resourceId:e});return n||!o?(console.error(n),{done:[],learning:[],skipped:[]}):($(t,e,o?.done||[],o?.learning||[],o?.skipped||[]),window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:t,resourceId:e,isFavorite:o.isFavorite}})),o)}function $(t,e,o,n,s){const r=w()?.id;localStorage.setItem(`${t}-${e}-${r}-progress`,JSON.stringify({done:o,learning:n,skipped:s,timestamp:new Date().getTime()}))}function R(t,e=document){const o=[];return e.querySelectorAll(`[data-group-id$="-${t}"]`).forEach(n=>{const s=n?.dataset?.groupId||"";new RegExp(`^\\d+-${t}$`).test(s)&&o.push(n)}),d([`[data-group-id="${t}"]`,`[data-group-id="check:${t}"]`,`[data-node-id="${t}"]`,`[data-id="${t}"]`],e).forEach(n=>{o.push(n)}),o}function h(t,e){const o=e==="learning",n=e==="skipped",s=e==="done",r=e==="removed";R(t).forEach(a=>{s?(a.classList.add("done"),a.classList.remove("learning","skipped")):o?(a.classList.add("learning"),a.classList.remove("done","skipped")):n?(a.classList.add("skipped"),a.classList.remove("done","learning")):r?(a.classList.add("removed"),a.classList.remove("done","learning","skipped")):a.classList.remove("done","skipped","learning","removed")})}function F(){const t=d([".clickable-group",'[data-type="topic"]','[data-type="subtopic"]',".react-flow__node-topic",".react-flow__node-subtopic"]);for(const e of t)e.classList.remove("done","skipped","learning","removed")}async function O(t,e){const{done:o=[],learning:n=[],skipped:s=[]}=await f(t,e)||{};o.forEach(r=>{h(r,"done")}),n.forEach(r=>{h(r,"learning")}),s.forEach(r=>{h(r,"skipped")}),T()}function d(t,e=document){const o=[];return t.forEach(n=>{e.querySelectorAll(n).forEach(s=>{o.push(s)})}),o}function T(){const t=document.querySelectorAll("[data-progress-nums-container]"),e=document.querySelectorAll("[data-progress-nums]");if(t.length===0||e.length===0)return;const o=d([".clickable-group",'[data-type="topic"]','[data-type="subtopic"]',".react-flow__node-topic",".react-flow__node-subtopic"]).length,n=document.querySelectorAll('[data-group-id^="ext_link:"]').length,s=document.querySelectorAll('[data-group-id^="json:"]').length,r=document.querySelectorAll('[data-group-id^="check:"]').length,c=document.querySelectorAll('[data-group-id^="check:"].done').length,a=document.querySelectorAll('[data-group-id^="check:"].learning').length,l=document.querySelectorAll('[data-group-id^="check:"].skipped').length,g=document.querySelectorAll(".clickable-group.removed").length,u=o-n-s-r-g,p=d(['.clickable-group.done:not([data-group-id^="ext_link:"])',"[data-node-id].done","[data-id].done"]).length-c,L=d([".clickable-group.learning","[data-node-id].learning","[data-id].learning"]).length-a,m=d([".clickable-group.skipped","[data-node-id].skipped","[data-id].skipped"]).length-l,k=document.querySelectorAll("[data-progress-done]");k.length>0&&k.forEach(i=>i.innerHTML=`${p}`);const E=document.querySelectorAll("[data-progress-learning]");E.length>0&&E.forEach(i=>i.innerHTML=`${L}`);const v=document.querySelectorAll("[data-progress-skipped]");v.length>0&&v.forEach(i=>i.innerHTML=`${m}`);const S=document.querySelectorAll("[data-progress-total]");S.length>0&&S.forEach(i=>i.innerHTML=`${u}`);const A=Math.round((p+m)/u*100)||0,y=document.querySelectorAll("[data-progress-percentage]");y.length>0&&y.forEach(i=>i.innerHTML=`${A}`),t.forEach(i=>i.classList.remove("striped-loader")),e.forEach(i=>{i.classList.remove("opacity-0")})}export{h as a,T as b,F as c,N as g,I as i,O as r,R as t,D as u};
