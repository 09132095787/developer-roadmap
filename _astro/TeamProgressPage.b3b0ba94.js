import{h as v,_ as D,p as M}from"./hooks.module.7cc4e70a.js";import{u as Q}from"./use-team-id.3d0ab368.js";import{a as H}from"./http.82ebf0f1.js";import{p as U}from"./page.c1a8a472.js";import{o as e}from"./jsxRuntime.module.afbf92fe.js";import{k as G}from"./preact.module.7b19fc78.js";import{u as K}from"./use-toast.fb52de5d.js";import{u as W}from"./index.c54070cf.js";import{b as X}from"./team.12f2469e.js";import{g as Y,s as Z}from"./browser.bcc09af3.js";import{E as ee}from"./external-link.a7a2cda9.js";import{u as _}from"./use-auth.13ac07ad.js";import{D as re}from"./index.es.ebad3893.js";import{S as se}from"./Spinner.95905af5.js";/* empty css                       */import{u as O}from"./use-outside-click.85d1a62f.js";import{u as V}from"./use-keydown.41d75069.js";import{a as S,u as te}from"./resource-progress.b09662c1.js";import{C as ne}from"./close.3a539829.js";import"./jwt.f0e0aa9c.js";import"./index.a98c85f5.js";import"./toast.1fe7142d.js";function oe(i){const{member:s,onShowResourceProgress:n,isMyProgress:m=!1}=i,p=s?.progress?.sort((l,g)=>g.done-l.done),[h,u]=v(!1);return e(G,{children:e("div",{className:"flex h-full min-h-[270px] flex-col overflow-hidden rounded-md border",children:[e("div",{className:"relative flex items-center gap-3 border-b p-3",children:[e("img",{src:s.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${s.avatar}`:"/images/default-avatar.png",alt:s.name||"",className:"h-8 w-8 rounded-full"}),e("div",{className:"inline-grid w-full",children:[!m&&e("h3",{className:"truncate font-medium",children:s.name}),m&&e("div",{className:"inline-grid grid-cols-[auto,32px] items-center gap-1.5",children:[e("h3",{className:"truncate font-medium",children:s.name}),e("span",{className:"rounded-md bg-red-500 px-1 py-0.5 text-xs text-white",children:"You"})]}),e("p",{className:"truncate text-sm text-gray-500",children:s.email})]})]}),e("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(h?p:p.slice(0,4)).map(l=>e("button",{onClick:()=>n(l.resourceId),className:"group relative overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none",children:[e("span",{className:"relative z-10 flex items-center justify-between text-sm",children:[e("span",{className:"inline-grid",children:e("span",{className:"truncate",children:l.resourceTitle})}),e("span",{className:"ml-1.5 shrink-0 text-xs text-gray-400",children:[l.done," / ",l.total]})]}),e("span",{className:"absolute inset-0 bg-gray-100 group-hover:bg-gray-200",style:{width:`${l.done/l.total*100}%`}})]},l.resourceId)),p.length>4&&!h&&e("button",{onClick:()=>u(!0),className:"text-sm text-gray-400 underline",children:["+ ",p.length-4," more"]}),h&&e("button",{onClick:()=>u(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),p.length===0&&e("div",{className:"text-sm text-gray-500",children:"No progress"})]})]},s._id)})}function ae(i){const{onShowResourceProgress:s}=i,{members:n,resourceTitle:m,resourceId:p}=i.roadmap,{t:h}=Y(),u=_(),[l,g]=v(!1);return e(G,{children:e("div",{className:"flex h-full min-h-[270px] flex-col rounded-md border",children:[e("div",{className:"flex items-center gap-3 border-b p-3",children:e("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[e("h3",{className:"truncate font-medium",children:m}),e("a",{href:`/${p}?t=${h}`,className:"group mb-0.5 flex shrink-0 items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:e("img",{alt:"link",src:ee,className:"ml-2 h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})})]})}),e("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(l?n:n.slice(0,4)).map(t=>{const N=u?.email===t?.member?.email;return t.progress?e("button",{className:`group relative w-full overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none ${N?"border-green-500 hover:border-green-600":""}`,onClick:()=>{s(t.member,t.progress?.resourceId)},children:[e("span",{className:"relative z-10 flex items-center justify-between gap-1 text-sm",children:[e("span",{className:"inline-grid grid-cols-[20px_auto] gap-3",children:[e("img",{src:t.member.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${t.member.avatar}`:"/images/default-avatar.png",alt:t.member.name||"",className:"h-5 w-5 shrink-0 rounded-full"}),e("span",{className:"inline-grid grid-cols-[auto,32px] items-center",children:e("span",{className:"mr-[5px] truncate",children:t?.member?.name})})]}),e("span",{className:"shrink-0 text-xs text-gray-400",children:[t?.progress?.done," / ",t?.progress?.total]})]}),e("span",{className:`absolute inset-0 ${N?"bg-green-100 group-hover:bg-green-200":"bg-gray-100 group-hover:bg-gray-200"}`,style:{width:`${t?.progress?.done/t?.progress?.total*100}%`}})]},t?.member._id):null}),n.length>4&&!l&&e("button",{onClick:()=>g(!0),className:"text-sm text-gray-400 underline",children:["+ ",n.length-4," more"]}),l&&e("button",{onClick:()=>g(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),n.length===0&&e("div",{className:"text-sm text-gray-500",children:"No progress"})]})]})})}function le(i){const{className:s}=i;return e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",className:s,children:[e("path",{d:"M18 6 6 18"}),e("path",{d:"m6 6 12 12"})]})}function ie(i){const{onClose:s}=i,n=D(null);return O(n,s),V("Escape",()=>{s()}),e("div",{className:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{className:"relative flex h-full w-full items-center justify-center",children:e("div",{className:"relative w-full max-w-lg rounded-md bg-yellow-50 px-3 py-3 text-gray-500",ref:n,children:[e("span",{className:"mb-1.5 block text-xs font-medium uppercase text-green-600",children:"Update Progress"}),e("p",{className:"text-sm",children:"Use the keyboard shortcuts listed below."}),e("ul",{className:"mb-1.5 mt-3 flex flex-col gap-1",children:[e("li",{className:"text-sm leading-loose",children:[e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Right Mouse Click"})," ","to mark as Done."]}),e("li",{className:"text-sm leading-loose",children:[e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Shift"})," ","+"," ",e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Click"})," ","to mark as in progress."]}),e("li",{className:"text-sm leading-loose",children:[e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Option / Alt"})," ","+"," ",e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Click"})," ","to mark as skipped."]})]}),e("button",{type:"button",className:"absolute right-1.5 top-1.5 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-yellow-200 hover:text-yellow-900",onClick:s,children:[e(le,{}),e("span",{class:"sr-only",children:"Close modal"})]})]})})})}function ce(i){const{resourceId:s,member:n,resourceType:m,onShowMyProgress:p,teamId:h,onClose:u}=i,g=_()?.email===n.email,t=D(null),N=D(null),[f,$]=v(!1),[C,I]=v(),[o,d]=v(!0),b=K();let y="https://roadmap.sh";m==="roadmap"?y+=`/${s}.json`:y+=`/best-practices/${s}.json`;async function T(r,a,c,x){const{error:w,response:k}=await H(`https://api.roadmap.sh/v1-get-member-resource-progress/${r}/${a}?resourceType=${c}&resourceId=${x}`);if(w||!k){b.error(w?.message||"Failed to get member progress");return}return I(k),k}async function q(r){const c=await(await fetch(r)).json(),x=await re(c,{fontURL:"/fonts/balsamiq.woff2"});t.current?.replaceChildren(x)}V("Escape",()=>{f||u()}),O(N,()=>{f||u()}),M(()=>{!t.current||!y||!s||!m||!h||(d(!0),Promise.all([q(y),T(h,n._id,m,s)]).then(([r,a={}])=>{const{removed:c=[],done:x=[],learning:w=[],skipped:k=[]}=a;x.forEach(P=>S(P,"done")),w.forEach(P=>S(P,"learning")),k.forEach(P=>S(P,"skipped")),c.forEach(P=>S(P,"removed"))}).catch(r=>{console.error(r),b.error(r?.message||"Something went wrong. Please try again!")}).finally(()=>{d(!1)}))},[n]);function L(r,a){!s||!m||!g||(U.set("Updating progress"),te({resourceId:s,resourceType:m,topicId:r},a).then(()=>{S(r,a),T(h,n._id,m,s).then(c=>{I(c)})}).catch(c=>{alert("Something went wrong, please try again."),console.error(c)}).finally(()=>{U.set("")}))}async function z(r){const a=r.target?.closest("g");if(!a)return;const c=a.dataset?a.dataset.groupId:"";if(!c)return;if(a.classList.contains("removed")){r.preventDefault();return}r.preventDefault();const x=a.classList.contains("done"),w=c.replace(/^\d+-/,"");L(w,x?"pending":"done")}async function A(r){const a=r.target?.closest("g");if(!a)return;const c=a.dataset?a.dataset.groupId:"";if(!c||a.classList.contains("removed"))return;r.preventDefault();const x=c.replace(/^\d+-/,""),w=a.classList.contains("learning"),k=a.classList.contains("skipped");if(r.shiftKey){r.preventDefault(),L(x,w?"pending":"learning");return}if(r.altKey){r.preventDefault(),L(x,k?"pending":"skipped");return}}M(()=>{if(!(!n||!t.current))return t.current?.addEventListener("contextmenu",z),t.current?.addEventListener("click",A),()=>{t.current?.removeEventListener("contextmenu",z),t.current?.removeEventListener("click",A)}},[n]);const E=C?.removed||[],j=C?.done.filter(r=>!E.includes(r)).length||0,J=C?.learning.filter(r=>!E.includes(r)).length||0,B=C?.skipped.filter(r=>!E.includes(r)).length||0,R=n.progress.find(r=>r.resourceId===s)?.total||0,F=Math.round(j/R*100);return e("div",{class:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{class:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e("div",{ref:N,class:"popup-body relative rounded-lg bg-white shadow",children:[f&&e(ie,{onClose:()=>{$(!1)}}),e("div",{className:"p-4",children:[g?e("div",{className:"mb-5 mt-0 text-left md:mt-4 md:text-center",children:[e("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:"Update Your Progress"}),e("p",{className:"text-gray-500",children:["Follow the"," ",e("button",{className:"inline-flex items-center text-blue-600 underline",onClick:()=>{$(!0)},children:"instructions to update your progress"})," "]})]}):e("div",{className:"mb-5 mt-0 text-left md:mt-4 md:text-center",children:[e("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[n.name,"'s Progress"]}),e("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:["You are looking at ",n.name,"'s progress."," ",e("button",{className:"text-blue-600 underline",onClick:p,children:"View your progress"}),"."]}),e("p",{className:"block text-gray-500 md:hidden",children:e("button",{className:"text-blue-600 underline",onClick:p,children:"View your progress."})})]}),e("p",{class:`-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden ${o?"striped-loader":""}`,children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:F}),"% Done"]}),e("span",{children:[e("span",{children:j})," of ",e("span",{children:R})," done"]})]}),e("p",{class:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${o?"striped-loader":""}`,children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:F}),"% Done"]}),e("span",{children:[e("span",{children:j})," completed"]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-learning":"",children:J})," in progress"]}),B>0&&e(G,{children:[e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-skipped":"",children:B})," ","skipped"]})]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-total":"",children:R})," Total"]})]})]}),e("div",{ref:t,className:"px-4 pb-2"}),o&&e("div",{class:"flex w-full justify-center",children:e(se,{isDualRing:!1,className:"mb-4 mt-2 h-4 w-4 animate-spin fill-blue-600 text-gray-200 sm:h-8 sm:w-8"})}),e("button",{type:"button",className:"popup-close absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900 sm:hidden",onClick:u,children:[e("img",{alt:"close",src:ne,className:"h-4 w-4"}),e("span",{class:"sr-only",children:"Close modal"})]})]})})})}const de=[{label:"Members",value:"member"},{label:"Roadmaps",value:"roadmap"}];function Re(){const{teamId:i}=Q(),{gb:s}=Y(),[n,m]=v(!0),p=K(),h=W(X),u=_(),[l,g]=v(),[t,N]=v([]),[f,$]=v(s||"member");async function C(){const{response:o,error:d}=await H(`https://api.roadmap.sh/v1-get-team-progress/${i}`);if(d||!o){p.error(d?.message||"Failed to get team progress");return}N(o.sort((b,y)=>b.email===u?.email?-1:y.email===u?.email?1:0))}if(M(()=>{i&&C().then(()=>{U.set(""),m(!1)})},[i]),n)return null;if(!i){window.location.href="/";return}M(()=>{f&&Z({gb:f})},[f]);const I=[];for(const o of h?.roadmaps||[]){const d=[];for(const b of t){const y=b.progress.find(T=>T.resourceId===o);y&&d.push({member:b,progress:y})}d.length&&I.push({resourceId:o,resourceTitle:d?.[0].progress?.resourceTitle||"",resourceType:"roadmap",members:d})}return e("div",{children:[l&&e(ce,{member:l.member,teamId:i,resourceId:l.resourceId,resourceType:"roadmap",onClose:()=>{g(void 0)},onShowMyProgress:()=>{g({resourceId:l.resourceId,member:t.find(o=>o.email===u?.email)})}}),e("div",{className:"flex items-center gap-2",children:de.map(o=>e("button",{className:`rounded-md border p-1 px-2 text-sm ${f===o.value?" border-gray-400 bg-gray-200 ":""}`,onClick:()=>$(o.value),children:o.label}))}),e("div",{className:"mt-6",children:[f==="roadmap"&&e("div",{className:"grid gap-4 sm:grid-cols-2",children:I.map(o=>e(ae,{roadmap:o,onShowResourceProgress:(d,b)=>{g({resourceId:b,member:d})}},o.resourceId))}),f==="member"&&e("div",{className:"grid gap-4 sm:grid-cols-2",children:t.map(o=>e(oe,{member:o,isMyProgress:o?.email===u?.email,onShowResourceProgress:d=>{g({resourceId:d,member:o})}}))})]})]})}export{Re as TeamProgressPage};
