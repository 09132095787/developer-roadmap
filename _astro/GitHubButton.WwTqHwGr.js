import{j as t}from"./jsx-runtime.KYujgZxC.js";import{r as l}from"./index.068npczX.js";import{G as I}from"./GitHubIcon.S41FbzfH.js";import{a as R,T as E}from"./jwt.E7BTUPpl.js";import{a as f}from"./http.0Kr6Lzfj.js";import{S as G}from"./Spinner.JIsgQuDp.js";const m="githubRedirectAt",d="githubLastPage";function _(j){const[g,o]=l.useState(!1),[u,r]=l.useState("");l.useEffect(()=>{const e=new URLSearchParams(window.location.search),a=e.get("code"),n=e.get("state"),S=e.get("provider");!a||!n||S!=="github"||(o(!0),f(`https://api.roadmap.sh/v1-github-callback${window.location.search}`).then(({response:i,error:x})=>{if(!i?.token){const c=x?.message||"Something went wrong.";r(c),o(!1);return}let s="/";const h=localStorage.getItem(m),p=localStorage.getItem(d);if(h&&p){const c=parseInt(h,10);Date.now()-c<30*1e3&&(s=p)}const w=localStorage.getItem("authRedirect");w&&(localStorage.removeItem("authRedirect"),s=w),localStorage.removeItem(m),localStorage.removeItem(d),R.set(E,i.token,{path:"/",expires:30,domain:".roadmap.sh"}),window.location.href=s}).catch(i=>{r("Something went wrong. Please try again later."),o(!1)}))},[]);const b=async()=>{o(!0);const{response:e,error:a}=await f("https://api.roadmap.sh/v1-github-login");if(a||!e?.loginUrl){r(a?.message||"Something went wrong. Please try again later."),o(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const n=["/respond-invite","/befriend"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(m,Date.now().toString()),localStorage.setItem(d,n)}window.location.href=e.loginUrl};return t.jsxs(t.Fragment,{children:[t.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:g,onClick:b,children:[g?t.jsx(G,{className:"h-[18px] w-[18px]",isDualRing:!1}):t.jsx(I,{className:"h-[18px] w-[18px]"}),"Continue with GitHub"]}),u&&t.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:u})]})}export{_ as GitHubButton};
