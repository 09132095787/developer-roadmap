import{j as e}from"./jsx-runtime.6940b965.js";import{r as d}from"./index.070054a4.js";import{a as K}from"./http.387f5009.js";import{p as M}from"./page.c1a8a472.js";import{u as q}from"./use-toast.fb52de5d.js";import{u as V}from"./index.2d760e66.js";import{a as Y}from"./team.f4809964.js";import{g as H,s as Q}from"./browser.6245b9a5.js";import{u as D}from"./use-auth.86ed5fb5.js";import{D as W}from"./index.es.ebad3893.js";import{S as X}from"./Spinner.799b0955.js";/* empty css                       */import{u as Z}from"./use-outside-click.d7ce4a3d.js";import{u as ee}from"./use-keydown.bb1f91bb.js";import{a as I,u as se}from"./resource-progress.9335d95d.js";import{C as re}from"./close.bb7a0ac2.js";import{r as te}from"./renderer.b3c7ce1f.js";import{g as z,a as B}from"./RoadmapRenderer.9b93aa0f.js";import"./jwt.ab9b7b25.js";import"./index.a98c85f5.js";import"./toast.1fe7142d.js";import"./index.3e34842a.js";import"./index.5f60dc5b.js";import"./createLucideIcon.3c9fdece.js";import"./shapes.18fdadc5.js";function ae(h){const{member:n,onShowResourceProgress:i,isMyProgress:u=!1}=h,p=n?.progress?.sort((r,y)=>y.done-r.done),[j,g]=d.useState(!1);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-full min-h-[270px] flex-col overflow-hidden rounded-md border",children:[e.jsxs("div",{className:"relative flex items-center gap-3 border-b p-3",children:[e.jsx("img",{src:n.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${n.avatar}`:"/images/default-avatar.png",alt:n.name||"",className:"h-8 min-h-[32px] w-8 min-w-[32px] rounded-full"}),e.jsxs("div",{className:"inline-grid w-full",children:[!u&&e.jsx("h3",{className:"truncate font-medium",children:n.name}),u&&e.jsxs("div",{className:"inline-grid grid-cols-[auto,32px] items-center gap-1.5",children:[e.jsx("h3",{className:"truncate font-medium",children:n.name}),e.jsx("span",{className:"rounded-md bg-red-500 px-1 py-0.5 text-xs text-white",children:"You"})]}),e.jsx("p",{className:"truncate text-sm text-gray-500",children:n.email})]})]}),e.jsxs("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(j?p:p.slice(0,4)).map(r=>e.jsxs("button",{onClick:()=>i(r.resourceId,r.isCustomResource),className:"group relative overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none",children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"inline-grid",children:e.jsx("span",{className:"truncate",children:r.resourceTitle})}),e.jsxs("span",{className:"ml-1.5 shrink-0 text-xs text-gray-400",children:[r.done," / ",r.total]})]}),e.jsx("span",{className:"absolute inset-0 bg-gray-100 group-hover:bg-gray-200",style:{width:`${r.done/r.total*100}%`}})]},r.resourceId)),p.length>4&&!j&&e.jsxs("button",{onClick:()=>g(!0),className:"text-sm text-gray-400 underline",children:["+ ",p.length-4," more"]}),j&&e.jsx("button",{onClick:()=>g(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),p.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"No progress"})]})]},n._id)})}const ne={src:"/_astro/external-link.9acaa7b2.svg",width:24,height:24,format:"svg"};function oe(h){const{onShowResourceProgress:n}=h,{members:i,resourceTitle:u,resourceId:p,isCustomResource:j}=h.roadmap,{t:g}=H(),r=D(),[y,v]=d.useState(!1),f=j?`/r?id=${p}`:`/${p}?t=${g}`;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-full min-h-[270px] flex-col rounded-md border",children:[e.jsx("div",{className:"flex items-center gap-3 border-b p-3",children:e.jsxs("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[e.jsx("h3",{className:"truncate font-medium",children:u}),e.jsx("a",{href:f,className:"group mb-0.5 flex shrink-0 items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:e.jsx("img",{alt:"link",src:ne.src,className:"ml-2 h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})})]})}),e.jsxs("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(y?i:i.slice(0,4)).map(a=>{const C=r?.email===a?.member?.email;return a.progress?e.jsxs("button",{className:`group relative w-full overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none ${C?"border-green-500 hover:border-green-600":""}`,onClick:()=>{n(a.member,a.progress?.resourceId)},children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-between gap-1 text-sm",children:[e.jsxs("span",{className:"inline-grid grid-cols-[20px_auto] gap-3",children:[e.jsx("img",{src:a.member.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${a.member.avatar}`:"/images/default-avatar.png",alt:a.member.name||"",className:"h-5 w-5 shrink-0 rounded-full"}),e.jsx("span",{className:"inline-grid grid-cols-[auto,32px] items-center",children:e.jsx("span",{className:"mr-[5px] truncate",children:a?.member?.name})})]}),e.jsxs("span",{className:"shrink-0 text-xs text-gray-400",children:[a?.progress?.done," / ",a?.progress?.total]})]}),e.jsx("span",{className:`absolute inset-0 ${C?"bg-green-100 group-hover:bg-green-200":"bg-gray-100 group-hover:bg-gray-200"}`,style:{width:`${a?.progress?.done/a?.progress?.total*100}%`}})]},a?.member._id):null}),i.length>4&&!y&&e.jsxs("button",{onClick:()=>v(!0),className:"text-sm text-gray-400 underline",children:["+ ",i.length-4," more"]}),y&&e.jsx("button",{onClick:()=>v(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),i.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"No progress"})]})]})})}function le(h){const{resourceId:n,member:i,resourceType:u,onShowMyProgress:p,teamId:j,onClose:g,isCustomResource:r}=h,v=D()?.email===i.email,f=d.useRef(null),a=d.useRef(null),[C,_]=d.useState(!1),[S,t]=d.useState(),[m,x]=d.useState(!0),P=q();let k="https://roadmap.sh";u==="roadmap"?k+=`/${n}.json`:k+=`/best-practices/${n}.json`,r&&(k=`https://api.roadmap.sh/v1-get-roadmap/${n}`);async function R(s,o,l,N){const{error:b,response:c}=await K(`https://api.roadmap.sh/v1-get-member-resource-progress/${s}/${o}?resourceType=${l}&resourceId=${N}`);if(b||!c){P.error(b?.message||"Failed to get member progress");return}return t(c),c}async function J(s){const l=await(await fetch(s,{...r&&{credentials:"include"}})).json();let N=null;r?N=await te({nodes:l.nodes,edges:l.edges},{fontURL:"/fonts/balsamiq.woff2"}):N=await W(l,{fontURL:"/fonts/balsamiq.woff2"}),f.current?.replaceChildren(N)}ee("Escape",()=>{C||g()}),Z(a,()=>{C||g()}),d.useEffect(()=>{!f.current||!k||!n||!u||!j||(x(!0),Promise.all([J(k),R(j,i._id,u,n)]).then(([s,o={}])=>{const{removed:l=[],done:N=[],learning:b=[],skipped:c=[]}=o;N.forEach(w=>I(w,"done")),b.forEach(w=>I(w,"learning")),c.forEach(w=>I(w,"skipped")),l.forEach(w=>I(w,"removed"))}).catch(s=>{console.error(s),P.error(s?.message||"Something went wrong. Please try again!")}).finally(()=>{x(!1)}))},[i]);function $(s,o){!n||!u||!v||(M.set("Updating progress"),se({resourceId:n,resourceType:u,topicId:s},o).then(()=>{I(s,o),R(j,i._id,u,n).then(l=>{t(l)})}).catch(l=>{alert("Something went wrong, please try again."),console.error(l)}).finally(()=>{M.set("")}))}async function F(s){const o=s.target?.closest("g");if(!o)return;let l="";if(r){const{nodeId:b,nodeType:c}=z(s.target)||{};if(!b||!c||!B.includes(c)||c==="button")return;l=b}else{const b=o.dataset?o.dataset.groupId:"";if(!b)return;l=b.replace(/^\d+-/,"")}if(o.classList.contains("removed")){s.preventDefault();return}s.preventDefault();const N=o?.classList.contains("done");$(l,N?"pending":"done")}async function U(s){const o=s.target?.closest("g");if(!o)return;let l="";if(r){const{nodeId:c,nodeType:w}=z(s.target)||{};if(!c||!w||!B.includes(w)||w==="button")return;l=c}else{const c=o.dataset?o.dataset.groupId:"";if(!c)return;l=c.replace(/^\d+-/,"")}if(o.classList.contains("removed"))return;s.preventDefault();const N=o.classList.contains("learning"),b=o.classList.contains("skipped");if(s.shiftKey){s.preventDefault(),$(l,N?"pending":"learning");return}if(s.altKey){s.preventDefault(),$(l,b?"pending":"skipped");return}}d.useEffect(()=>{if(!(!i||!f.current))return f.current?.addEventListener("contextmenu",F),f.current?.addEventListener("click",U),()=>{f.current?.removeEventListener("contextmenu",F),f.current?.removeEventListener("click",U)}},[i]);const T=S?.removed||[],L=S?.done.filter(s=>!T.includes(s)).length||0,O=S?.learning.filter(s=>!T.includes(s)).length||0,G=S?.skipped.filter(s=>!T.includes(s)).length||0,E=i.progress.find(s=>s.resourceId===n)?.total||0,A=Math.round(L/E*100);return e.jsx("div",{className:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{id:r?"original-roadmap":"customized-roadmap",className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{ref:a,className:"popup-body relative rounded-lg bg-white pt-[1px] shadow",children:[v&&e.jsxs("div",{className:"sticky top-1 mx-1 mb-0 mt-1 rounded-xl bg-gray-900 p-4 text-gray-300",children:[e.jsx("h2",{className:"mb-1.5 text-base",children:"Follow the Instructions below to update your progress"}),e.jsxs("ul",{className:"flex flex-col gap-1",children:[e.jsxs("li",{className:"leading-loose",children:[e.jsx("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Right Mouse Click"})," ","on a topic to mark as"," ",e.jsx("span",{className:"font-medium text-white",children:"Done"}),"."]}),e.jsxs("li",{className:"leading-loose",children:[e.jsx("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Shift"})," ","+"," ",e.jsx("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Click"})," ","on a topic to mark as"," ",e.jsx("span",{className:"font-medium text-white",children:"In progress"}),"."]})]})]}),e.jsxs("div",{className:"p-4",children:[!v&&e.jsxs("div",{className:"mb-5 mt-0 text-left md:mt-4 md:text-center",children:[e.jsxs("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[i.name,"'s Progress"]}),e.jsxs("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:["You are looking at ",i.name,"'s progress."," ",e.jsx("button",{className:"text-blue-600 underline",onClick:p,children:"View your progress"}),"."]}),e.jsx("p",{className:"block text-gray-500 md:hidden",children:e.jsx("button",{className:"text-blue-600 underline",onClick:p,children:"View your progress."})})]}),e.jsxs("p",{className:`-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden ${m?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:A}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:L})," of ",e.jsx("span",{children:E})," done"]})]}),e.jsxs("p",{className:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${m?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:A}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:L})," completed"]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{"data-progress-learning":"",children:O})," in progress"]}),G>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{"data-progress-skipped":"",children:G})," ","skipped"]})]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{"data-progress-total":"",children:E})," Total"]})]})]}),e.jsx("div",{id:"resource-svg-wrap",ref:f,className:"px-4 pb-2"}),m&&e.jsx("div",{className:"flex w-full justify-center",children:e.jsx(X,{isDualRing:!1,className:"mb-4 mt-2 h-4 w-4 animate-spin fill-blue-600 text-gray-200 sm:h-8 sm:w-8"})}),e.jsxs("button",{type:"button",className:`absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden ${v?"hover:bg-gray-800":"hover:bg-gray-100"}`,onClick:g,children:[e.jsx("img",{alt:"close",src:re.src,className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})})}const ie=[{label:"Members",value:"member"},{label:"Roadmaps",value:"roadmap"}];function De(){const{t:h,gb:n}=H(),[i,u]=d.useState(!0),p=q(),j=V(Y),g=D(),[r,y]=d.useState(),[v,f]=d.useState([]),[a,C]=d.useState(n||"member");async function _(){const{response:t,error:m}=await K(`https://api.roadmap.sh/v1-get-team-progress/${h}`);if(m||!t){p.error(m?.message||"Failed to get team progress");return}f(t.sort((x,P)=>x.email===g?.email?-1:P.email===g?.email?1:0))}d.useEffect(()=>{h&&_().then(()=>{M.set(""),u(!1)})},[h]),d.useEffect(()=>{a&&Q({gb:a})},[a]);const S=[];for(const t of j?.roadmaps||[]){let m=!1;const x=[];for(const P of v){const k=P.progress.find(R=>R.resourceId===t);k&&(k.isCustomResource&&!m&&(m=!0),x.push({member:P,progress:k}))}x.length&&S.push({resourceId:t,resourceTitle:x?.[0].progress?.resourceTitle||"",resourceType:"roadmap",members:x,isCustomResource:m})}if(!h){window.location.href="/";return}return i?null:e.jsxs("div",{children:[r&&e.jsx(le,{member:r.member,teamId:h,resourceId:r.resourceId,resourceType:"roadmap",isCustomResource:r.isCustomResource,onClose:()=>{y(void 0)},onShowMyProgress:()=>{y({resourceId:r.resourceId,member:v.find(t=>t.email===g?.email),isCustomResource:r.isCustomResource})}}),e.jsx("div",{className:"flex items-center gap-2",children:ie.map(t=>e.jsx("button",{className:`rounded-md border p-1 px-2 text-sm ${a===t.value?" border-gray-400 bg-gray-200 ":""}`,onClick:()=>C(t.value),children:t.label},t.value))}),e.jsxs("div",{className:"mt-6",children:[a==="roadmap"&&e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:S.map(t=>e.jsx(oe,{roadmap:t,onShowResourceProgress:(m,x)=>{y({resourceId:x,member:m,isCustomResource:t.isCustomResource})}},t.resourceId))}),a==="member"&&e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:v.map(t=>e.jsx(ae,{member:t,isMyProgress:t?.email===g?.email,onShowResourceProgress:(m,x)=>{y({resourceId:m,member:t,isCustomResource:x})}},t._id))})]})]})}export{De as TeamProgressPage};
