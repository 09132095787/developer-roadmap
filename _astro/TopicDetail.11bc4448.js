import{p as w,h as c,_ as P,F as N}from"./hooks.module.ee390651.js";import{C as R}from"./close.3a539829.js";import{S as $}from"./spinner.164b1eeb.js";import{a as A}from"./http.1ee0e3a2.js";import{i as D}from"./jwt.2bcbdb7f.js";import{g as G,u as M,r as U,i as O}from"./resource-progress.ed3451b2.js";import{p as E,s as z}from"./page.d4f83d9f.js";import{o as e}from"./jsxRuntime.module.760e3403.js";import{_ as B}from"./preact.module.e54f245b.js";function F(s,t){w(()=>{const n=r=>{r.key.toLowerCase()===s.toLowerCase()&&t()};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[])}function j(s){w(()=>{function t(n){const{resourceType:r,resourceId:a,topicId:p}=n.detail;s({resourceType:r,resourceId:a,topicId:p})}return window.addEventListener("roadmap.topic.click",t),window.addEventListener("best-practice.topic.click",t),()=>{window.removeEventListener("roadmap.topic.click",t),window.removeEventListener("best-practice.topic.click",t)}},[])}function H(s,t){w(()=>{const n=r=>{!s?.current?.contains(r.target)&&t()};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}},[s])}function K(s){w(()=>{function t(n){const{resourceType:r,resourceId:a,topicId:p}=n.detail;s({resourceType:r,resourceId:a,topicId:p})}return window.addEventListener("best-practice.topic.toggle",t),()=>{window.removeEventListener("best-practice.topic.toggle",t)}},[])}const J="/_astro/down.93d0ce97.svg",b={done:"bg-green-500",learning:"bg-yellow-500",pending:"bg-gray-300",skipped:"bg-black"};function Q(s){const{topicId:t,resourceId:n,resourceType:r,onClose:a,onShowLoginPopup:p}=s,[k,m]=c(!0),[l,h]=c("pending"),[v,x]=c(!1),f=P(null);H(f,()=>{x(!1)});const L=N(()=>!D(),[]);w(()=>{!t||!n||!r||(m(!0),G({topicId:t,resourceId:n,resourceType:r}).then(o=>{m(!1),h(o)}).catch(console.error))},[t,n,r]);const u=o=>{if(L){a(),p();return}m(!0),M({topicId:t,resourceId:n,resourceType:r},o).then(()=>{h(o),a(),U(t,o)}).catch(i=>{alert(i.message),console.error(i)}).finally(()=>{m(!1)})},C=["pending","learning","done"].includes(l),y=["skipped","pending","learning"].includes(l),S=["done","skipped","pending"].includes(l),T=["skipped","done","learning"].includes(l);return k?e("button",{className:"inline-flex cursor-default items-center rounded-md border border-gray-300 bg-white p-1 px-2 text-sm text-black",children:[e("img",{alt:"Check",class:"h-4 w-4 animate-spin",src:$}),e("span",{className:"ml-2",children:"Updating Status.."})]}):e("div",{className:"relative inline-flex rounded-md border border-gray-300",children:[e("span",{className:"inline-flex cursor-default items-center  p-1 px-2 text-sm text-black",children:[e("span",{class:"flex h-2 w-2",children:e("span",{class:`relative inline-flex h-2 w-2 rounded-full ${b[l]}`})}),e("span",{className:"ml-2 capitalize",children:l==="learning"?"In Progress":l})]}),e("button",{className:"inline-flex cursor-pointer items-center rounded-br-md rounded-tr-md border-l border-l-gray-300 bg-gray-100 p-1 px-2 text-sm text-black hover:bg-gray-200",onClick:()=>x(!0),children:[e("span",{className:"mr-0.5",children:"Update Status"}),e("img",{alt:"Check",class:"h-4 w-4",src:J})]}),v&&e("div",{className:"absolute right-0 top-full mt-1 flex min-w-[128px] flex-col divide-y rounded-md border border-gray-200 bg-white shadow-md [&>button:first-child]:rounded-t-md [&>button:last-child]:rounded-b-md",ref:f,children:[y&&e("button",{class:"px-3 py-1.5 text-left text-sm text-gray-800 hover:bg-gray-100",onClick:()=>u("done"),children:[e("span",{class:`mr-2 inline-block h-2 w-2 rounded-full ${b.done}`}),"Done"]}),S&&e("button",{class:"px-3 py-1.5 text-left text-sm text-gray-800 hover:bg-gray-100",onClick:()=>u("learning"),children:[e("span",{class:`mr-2 inline-block h-2 w-2 rounded-full ${b.learning}`}),"In Progress"]}),T&&e("button",{class:"px-3 py-1.5 text-left text-sm text-gray-800 hover:bg-gray-100",onClick:()=>u("pending"),children:[e("span",{class:`mr-2 inline-block h-2 w-2 rounded-full ${b.pending}`}),"Pending"]}),C&&e("button",{class:"px-3 py-1.5 text-left text-sm text-gray-800 hover:bg-gray-100",onClick:()=>u("skipped"),children:[e("span",{class:`mr-2 inline-block h-2 w-2 rounded-full ${b.skipped}`}),"Skip"]})]})]})}function se(){const[s,t]=c(!1),[n,r]=c(!1),[a,p]=c(""),[k,m]=c(""),l=N(()=>!D(),[]),h=P(null),[v,x]=c(""),[f,L]=c(""),[u,C]=c("roadmap"),y=()=>{const o=document.querySelector("#login-popup");if(!o)return;o.classList.remove("hidden"),o.classList.add("flex");const i=o.querySelector("[autofocus]");i&&i.focus()};if(H(h,()=>{t(!1)}),F("Escape",()=>{t(!1)}),K(({topicId:o,resourceType:i,resourceId:g})=>{if(l){y();return}E.set("Updating"),O({topicId:o,resourceId:g,resourceType:i}).then(d=>M({topicId:o,resourceId:g,resourceType:i},d?"pending":"done")).then(({done:d=[]})=>{U(o,d.includes(o)?"done":"pending")}).catch(d=>{alert(d.message),console.error(d)}).finally(()=>{E.set("")})}),j(({topicId:o,resourceType:i,resourceId:g})=>{r(!0),t(!0),z.set(!0),x(o),C(i),L(g);const d=o.replaceAll(":","/"),_=i==="roadmap"?`/${g}/${d}`:`/best-practices/${g}/${d}`;A(_,{},{headers:{Accept:"text/html"}}).then(({response:I})=>{if(!I){p("Topic not found.");return}const q=new DOMParser().parseFromString(I,"text/html")?.getElementById("main-content")?.outerHTML||"";r(!1),m(q)}).catch(I=>{p("Something went wrong. Please try again later."),r(!1)})}),!s)return null;const T=`https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/${u==="roadmap"?"roadmaps":"best-practices"}/${f}/content`;return e("div",{children:[e("div",{ref:h,className:"fixed right-0 top-0 z-40 h-screen w-full overflow-y-auto bg-white p-4 sm:max-w-[600px] sm:p-6",children:[n&&e("div",{className:"flex w-full justify-center",children:e("img",{src:$,alt:"Loading",className:"h-6 w-6 animate-spin fill-blue-600 text-gray-200 sm:h-12 sm:w-12"})}),!n&&!a&&e(B,{children:[e("div",{className:"mb-2",children:[e(Q,{topicId:v,resourceId:f,resourceType:u,onShowLoginPopup:y,onClose:()=>{t(!1)}}),e("button",{type:"button",id:"close-topic",className:"absolute right-2.5 top-2.5 inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900",onClick:()=>t(!1),children:e("img",{alt:"Close",class:"h-5 w-5",src:R})})]}),e("div",{id:"topic-content",className:"prose prose-quoteless prose-h1:mb-2.5 prose-h1:mt-7 prose-h2:mb-3 prose-h2:mt-0 prose-h3:mb-[5px] prose-h3:mt-[10px] prose-p:mb-2 prose-p:mt-0 prose-blockquote:font-normal prose-blockquote:not-italic prose-blockquote:text-gray-700 prose-li:m-0 prose-li:mb-0.5",dangerouslySetInnerHTML:{__html:k}}),e("p",{id:"contrib-meta",class:"mt-10 border-t pt-3 text-sm leading-relaxed text-gray-400",children:["Contribute links to learning resources about this topic"," ",e("a",{target:"_blank",class:"text-blue-700 underline",href:T,children:"on GitHub repository."}),"."]})]})]}),e("div",{class:"fixed inset-0 z-30 bg-gray-900 bg-opacity-50 dark:bg-opacity-80"})]})}export{se as TopicDetail};
