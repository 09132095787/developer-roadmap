import{j as o}from"./jsx-runtime.6940b965.js";import{r as l}from"./index.070054a4.js";import{a as E,T as R}from"./jwt.ab9b7b25.js";import{S as G}from"./spinner.6a5ba5e9.js";import{a as f}from"./http.387f5009.js";const v={src:"/_astro/google.b1c95028.svg",width:90,height:92,format:"svg"},g="googleRedirectAt",m="googleLastPage";function C(P){const[r,t]=l.useState(!1),[d,a]=l.useState(""),u=r?G:v;l.useEffect(()=>{const e=new URLSearchParams(window.location.search),n=e.get("code"),i=e.get("state"),x=e.get("provider");!n||!i||x!=="google"||(t(!0),f(`https://api.roadmap.sh/v1-google-callback${window.location.search}`).then(({response:s,error:I})=>{if(!s?.token){a(I?.message||"Something went wrong."),t(!1);return}let c="/";const h=localStorage.getItem(g),p=localStorage.getItem(m);if(h&&p){const b=parseInt(h,10);Date.now()-b<30*1e3&&(c=p)}const w=localStorage.getItem("authRedirect");w&&(localStorage.removeItem("authRedirect"),c=w),localStorage.removeItem(g),localStorage.removeItem(m),E.set(R,s.token,{path:"/",expires:30,domain:".roadmap.sh"}),window.location.href=c}).catch(s=>{a("Something went wrong. Please try again later."),t(!1)}))},[]);const S=()=>{t(!0),f("https://api.roadmap.sh/v1-google-login").then(({response:e,error:n})=>{if(!e?.loginUrl){a(n?.message||"Something went wrong."),t(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const i=["/respond-invite","/befriend"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(g,Date.now().toString()),localStorage.setItem(m,i)}window.location.href=e.loginUrl}).catch(e=>{a("Something went wrong. Please try again later."),t(!1)})};return o.jsxs(o.Fragment,{children:[o.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:r,onClick:S,children:[o.jsx("img",{src:u.src,alt:"Google",className:`h-[18px] w-[18px] ${r?"animate-spin":""}`}),"Continue with Google"]}),d&&o.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:d})]})}export{C as GoogleButton};
