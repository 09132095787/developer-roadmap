import{j as e}from"./jsx-runtime.6940b965.js";import{r as a}from"./index.070054a4.js";import{D as O}from"./index.es.ebad3893.js";/* empty css                       */import{u as _}from"./use-outside-click.d7ce4a3d.js";import{u as B}from"./use-keydown.bb1f91bb.js";import{a as L}from"./http.387f5009.js";import{t as y}from"./resource-progress.9335d95d.js";import{C as K}from"./close.bb7a0ac2.js";import{g as V,d as C}from"./browser.6245b9a5.js";import{u as Y}from"./use-auth.86ed5fb5.js";import{S as Q}from"./Spinner.799b0955.js";import{E as W}from"./ErrorIcon.977ee49a.js";import{r as X}from"./renderer.b3c7ce1f.js";import"./jwt.ab9b7b25.js";import"./index.5f60dc5b.js";function he(R){const{resourceId:l,resourceType:u,userId:A,onClose:b,isCustomResource:w}=R,{s:n=A}=V();if(!n)return null;const I=a.useRef(null),N=a.useRef(null),$=Y(),[U,M]=a.useState(!!n),[T,q]=a.useState(null),[S,D]=a.useState(),[x,v]=a.useState(!0),[h,E]=a.useState("");let i="https://roadmap.sh";u==="roadmap"?i+=`/${l}.json`:i+=`/best-practices/${l}.json`,w&&(i=`https://api.roadmap.sh/v1-get-roadmap/${l}`);async function F(s,t,o){const{error:p,response:m}=await L(`https://api.roadmap.sh/v1-get-user-progress/${s}?resourceType=${t}&resourceId=${o}`);if(p||!m)throw p||new Error("Something went wrong. Please try again!");return m}async function J(s){const{error:t,response:o}=await L(s);if(t||!o)throw t||new Error("Something went wrong. Please try again!");return w?await X({nodes:o?.nodes||[],edges:o?.edges||[]}):await O(o,{fontURL:"/fonts/balsamiq.woff2"})}function f(){C("s"),E(""),M(!1),b?b():window.location.reload()}B("Escape",()=>{f()}),_(N,()=>{f()}),a.useEffect(()=>{!i||!l||!u||!n||(v(!0),Promise.all([J(i),F(n,u,l)]).then(([s,t])=>{if(!t||!s)return;const{progress:o}=t,{done:p,learning:m,skipped:H}=o||{done:[],learning:[],skipped:[]};p?.forEach(r=>{y(r,s).forEach(c=>{c.classList.add("done")})}),m?.forEach(r=>{y(r,s).forEach(c=>{c.classList.add("learning")})}),H?.forEach(r=>{y(r,s).forEach(c=>{c.classList.add("skipped")})}),s.querySelectorAll(".clickable-group").forEach(r=>{r.classList.remove("clickable-group")}),s.querySelectorAll("[data-group-id]").forEach(r=>{r.removeAttribute("data-group-id")}),s.querySelectorAll("[data-node-id]").forEach(r=>{r.removeAttribute("data-node-id")}),s.querySelectorAll("[data-type]").forEach(r=>{r.removeAttribute("data-type")}),q(s),D(t)}).catch(s=>{E(s?.message||"Something went wrong. Please try again!")}).finally(()=>{v(!1)}))},[n]);const z=S?.user,d=S?.progress,g=d?.total||0,j=d?.done?.length||0,k=Math.round(j/g*100)||0,G=d?.learning?.length||0,P=d?.skipped?.length||0;return $?.id===n?(C("s"),null):U?x||h?e.jsx("div",{className:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{className:"relative mx-auto flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"popup-body relative rounded-lg bg-white p-5 shadow",children:e.jsxs("div",{className:"flex items-center",children:[x&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-6 w-6",isDualRing:!1}),e.jsx("span",{className:"ml-3 text-lg font-semibold",children:"Loading user progress..."})]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(W,{additionalClasses:"h-6 w-6 text-red-500"}),e.jsx("span",{className:"ml-3 text-lg font-semibold",children:h})]})]})})})}):e.jsx("div",{id:"user-progress-modal",className:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{ref:N,className:"popup-body relative rounded-lg bg-white pt-[1px] shadow",children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-5 mt-0 min-h-[28px] text-left sm:text-center md:mt-4 md:h-[60px]",children:[e.jsxs("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[z?.name,"'s Progress"]}),e.jsx("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:"You can close this popup and start tracking your progress."})]}),e.jsxs("p",{className:"-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden",children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:k}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:j})," of ",e.jsx("span",{children:g})," done"]})]}),e.jsxs("p",{className:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${x?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:k}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:j})," completed"]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:G})," in progress"]}),P>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:P})," skipped"]})]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:g})," Total"]})]})]}),e.jsx("div",{ref:I,className:"px-4 pb-2",dangerouslySetInnerHTML:{__html:T?.outerHTML||""}}),e.jsxs("button",{type:"button",className:"absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-gray-100 bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden",onClick:f,children:[e.jsx("img",{alt:"close",src:K.src,className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})}):null}export{he as UserProgressModal};
