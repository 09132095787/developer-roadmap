import{_ as j,h,p as T}from"./hooks.module.7cc4e70a.js";import{u as Q}from"./use-team-id.3d0ab368.js";import{a as Y}from"./http.82ebf0f1.js";import{p as D}from"./page.c1a8a472.js";import{D as W}from"./index.es.ebad3893.js";import{S as X}from"./Spinner.95905af5.js";/* empty css                       */import{u as H}from"./use-outside-click.85d1a62f.js";import{u as K}from"./use-keydown.41d75069.js";import{a as $,u as Z}from"./resource-progress.b09662c1.js";import{C as ee}from"./close.3a539829.js";import{u as F}from"./use-toast.fb52de5d.js";import{u as R}from"./use-auth.13ac07ad.js";import{o as e}from"./jsxRuntime.module.afbf92fe.js";import{k as _}from"./preact.module.7b19fc78.js";import{u as re}from"./index.c54070cf.js";import{b as te}from"./team.12f2469e.js";import{g as O,s as se}from"./browser.bcc09af3.js";import{E as ne}from"./external-link.a7a2cda9.js";import"./jwt.f0e0aa9c.js";import"./index.a98c85f5.js";import"./toast.1fe7142d.js";function ae(c){const{className:r}=c;return e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",className:r,children:[e("path",{d:"M18 6 6 18"}),e("path",{d:"m6 6 12 12"})]})}function oe(c){const{onClose:r}=c,d=j(null);return H(d,r),K("Escape",()=>{r()}),e("div",{className:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{className:"relative flex h-full w-full items-center justify-center",children:e("div",{className:"relative w-full max-w-lg rounded-md border border-yellow-300 bg-yellow-50 px-3 py-3 text-gray-500",ref:d,children:[e("span",{className:"mb-1.5 block text-xs font-medium uppercase text-green-600",children:"Update Progress"}),e("p",{className:"text-sm",children:"Use the keyboard shortcuts listed below."}),e("ul",{className:"mb-1.5 mt-3 flex flex-col gap-1",children:[e("li",{className:"text-sm leading-loose",children:[e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Right Mouse Click"})," ","to mark as Done."]}),e("li",{className:"text-sm leading-loose",children:[e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Shift"})," ","+"," ",e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Click"})," ","to mark as in progress."]}),e("li",{className:"text-sm leading-loose",children:[e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Option / Alt"})," ","+"," ",e("kbd",{className:"rounded-md bg-gray-900 px-2 py-1.5 text-xs text-white",children:"Click"})," ","to mark as skipped."]})]}),e("button",{type:"button",className:"absolute right-1.5 top-1.5 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-yellow-200 hover:text-yellow-900",onClick:r,children:[e(ae,{}),e("span",{class:"sr-only",children:"Close modal"})]})]})})})}function V(c){const{resourceId:r,member:d,resourceType:u,teamId:l,onClose:f}=c,p=R()?.email===d.email,i=j(null),s=j(null),[b,w]=h(!1),[n,a]=h(),[y,C]=h(!0),N=F();let P="https://roadmap.sh";u==="roadmap"?P+=`/${r}.json`:P+=`/best-practices/${r}.json`;async function G(t,o,m,x){const{error:v,response:k}=await Y(`https://api.roadmap.sh/v1-get-member-resource-progress/${t}/${o}?resourceType=${m}&resourceId=${x}`);if(v||!k){N.error(v?.message||"Failed to get member progress");return}return a(k),k}async function q(t){const m=await(await fetch(t)).json(),x=await W(m,{fontURL:"/fonts/balsamiq.woff2"});i.current?.replaceChildren(x)}K("Escape",()=>{b||f()}),H(s,()=>{b||f()}),T(()=>{!i.current||!P||!r||!u||!l||Promise.all([q(P),G(l,d._id,u,r)]).then(([t,o={}])=>{const{removed:m=[],done:x=[],learning:v=[],skipped:k=[]}=o;x.forEach(I=>$(I,"done")),v.forEach(I=>$(I,"learning")),k.forEach(I=>$(I,"skipped")),m.forEach(I=>$(I,"removed"))}).catch(t=>{console.error(t),N.error(t?.message||"Something went wrong. Please try again!")}).finally(()=>{C(!1)})},[]);function S(t,o){!r||!u||!p||(D.set("Updating progress"),Z({resourceId:r,resourceType:u,topicId:t},o).then(()=>{$(t,o),G(l,d._id,u,r).then(m=>{a(m)})}).catch(m=>{alert("Something went wrong, please try again."),console.error(m)}).finally(()=>{D.set("")}))}async function U(t){const o=t.target?.closest("g");if(!o)return;const m=o.dataset?o.dataset.groupId:"";if(!m||o.classList.contains("removed"))return;t.preventDefault();const x=o.classList.contains("done"),v=m.replace(/^\d+-/,"");S(v,x?"pending":"done")}async function z(t){const o=t.target?.closest("g");if(!o)return;const m=o.dataset?o.dataset.groupId:"";if(!m||o.classList.contains("removed"))return;t.preventDefault();const x=m.replace(/^\d+-/,""),v=o.classList.contains("learning"),k=o.classList.contains("skipped");if(t.shiftKey){t.preventDefault(),S(x,v?"pending":"learning");return}if(t.altKey){t.preventDefault(),S(x,k?"pending":"skipped");return}}T(()=>{if(!(!p||!i.current))return i.current?.addEventListener("contextmenu",U),i.current?.addEventListener("click",z),()=>{i.current?.removeEventListener("contextmenu",U),i.current?.removeEventListener("click",z)}},[]);const L=n?.removed||[],M=n?.done.filter(t=>!L.includes(t)).length||0,J=n?.learning.filter(t=>!L.includes(t)).length||0,A=n?.skipped.filter(t=>!L.includes(t)).length||0,E=d.progress.find(t=>t.resourceId===r)?.total||0,B=Math.round(M/E*100);return e("div",{class:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e("div",{class:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e("div",{ref:s,class:"popup-body relative rounded-lg bg-white shadow",children:[b&&e(oe,{onClose:()=>{w(!1)}}),e("div",{className:"p-4",children:[p?e("div",{className:"mb-5 mt-0 text-left md:mt-4 md:text-center",children:[e("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:"Your Progress"}),e("p",{className:"text-gray-500",children:["You can"," ",e("button",{className:"inline-flex items-center text-blue-600 underline",onClick:()=>{w(!0)},children:"follow these instructions"})," ","to update your progress below."]})]}):e("div",{className:"mb-5 mt-0 text-left md:mt-4 md:text-center",children:[e("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[d.name,"'s Progress"]}),e("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:["You are looking at ",d.name,"'s progress."," ",e("a",{target:"_blank",href:`/${r}?t=${l}`,className:"text-blue-600 underline",children:"View your progress"}),"."]}),e("p",{className:"block text-gray-500 md:hidden",children:["View your progress ",e("a",{target:"_blank",href:`/${r}?t=${l}`,className:"text-blue-600 underline",children:"on the roadmap page."})]})]}),e("p",{class:"-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden",children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:B}),"% Done"]}),e("span",{children:[e("span",{children:M})," of ",e("span",{children:E})," done"]})]}),e("p",{class:"-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex",children:[e("span",{class:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e("span",{children:B}),"% Done"]}),e("span",{children:[e("span",{children:M})," completed"]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-learning":"",children:J})," in progress"]}),A>0&&e(_,{children:[e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-skipped":"",children:A})," ","skipped"]})]}),e("span",{class:"mx-1.5 text-gray-400",children:"·"}),e("span",{children:[e("span",{"data-progress-total":"",children:E})," Total"]})]})]}),e("div",{ref:i,className:"px-4 pb-2"}),y&&e("div",{class:"flex w-full justify-center",children:e(X,{isDualRing:!1,className:"mb-4 mt-2 h-4 w-4 animate-spin fill-blue-600 text-gray-200 sm:h-8 sm:w-8"})}),e("button",{type:"button",className:"popup-close absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900 sm:hidden",onClick:f,children:[e("img",{src:ee,className:"h-4 w-4"}),e("span",{class:"sr-only",children:"Close modal"})]})]})})})}function le(c){const{member:r,teamId:d,isMyProgress:u=!1}=c,l=r?.progress?.sort((s,b)=>b.done-s.done),[f,g]=h(null),[p,i]=h(!1);return e(_,{children:[f&&e(V,{member:r,teamId:d,resourceId:f,resourceType:"roadmap",onClose:()=>{g(null)}}),e("div",{className:"flex h-full min-h-[270px] flex-col overflow-hidden rounded-md border",children:[e("div",{className:"relative flex items-center gap-3 border-b p-3",children:[e("img",{src:r.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${r.avatar}`:"/images/default-avatar.png",alt:r.name||"",className:"h-8 w-8 rounded-full"}),e("div",{className:"inline-grid w-full",children:[!u&&e("h3",{className:"truncate font-medium",children:r.name}),u&&e("div",{className:"inline-grid grid-cols-[auto,32px] items-center gap-1.5",children:[e("h3",{className:"truncate font-medium",children:r.name}),e("span",{className:"rounded-md bg-red-500 py-0.5 px-1 text-xs text-white",children:"You"})]}),e("p",{className:"truncate text-sm text-gray-500",children:r.email})]})]}),e("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(p?l:l.slice(0,4)).map(s=>e("button",{onClick:()=>g(s.resourceId),className:"group relative overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none",children:[e("span",{className:"relative z-10 flex items-center justify-between text-sm",children:[e("span",{className:"inline-grid",children:e("span",{className:"truncate",children:s.resourceTitle})}),e("span",{className:"ml-1.5 shrink-0 text-xs text-gray-400",children:[s.done," / ",s.total]})]}),e("span",{className:"absolute inset-0 bg-gray-100 group-hover:bg-gray-200",style:{width:`${s.done/s.total*100}%`}})]},s.resourceId)),l.length>4&&!p&&e("button",{onClick:()=>i(!0),className:"text-sm text-gray-400 underline",children:["+ ",l.length-4," more"]}),p&&e("button",{onClick:()=>i(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),l.length===0&&e("div",{className:"text-sm text-gray-500",children:"No progress"})]})]},r._id)]})}function ie(c){const{members:r,resourceTitle:d,resourceId:u}=c.roadmap,{t:l}=O(),f=R(),[g,p]=h(!1),[i,s]=h(null),[b,w]=h(null);return e(_,{children:[i&&e(V,{member:b,teamId:l,resourceId:i,resourceType:"roadmap",onClose:()=>{s(null),w(null)}}),e("div",{className:"flex h-full min-h-[270px] flex-col rounded-md border",children:[e("div",{className:"flex items-center gap-3 border-b p-3",children:e("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[e("h3",{className:"truncate font-medium",children:d}),e("a",{href:`/${u}?t=${l}`,className:"group mb-0.5 flex shrink-0 items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:e("img",{alt:"link",src:ne,className:"ml-2 h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})})]})}),e("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(g?r:r.slice(0,4)).map(n=>{const a=f?.email===n?.member?.email;return n.progress?e("button",{className:`group relative w-full overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none ${a?"border-green-500 hover:border-green-600":""}`,onClick:()=>{s(n?.progress?.resourceId),w(n.member)},children:[e("span",{className:"relative z-10 flex items-center justify-between gap-1 text-sm",children:[e("span",{className:"inline-grid grid-cols-[20px_auto] gap-3",children:[e("img",{src:n.member.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${n.member.avatar}`:"/images/default-avatar.png",alt:n.member.name||"",className:"h-5 w-5 shrink-0 rounded-full"}),e("span",{className:"inline-grid grid-cols-[auto,32px] items-center",children:e("span",{className:"truncate mr-[5px]",children:n?.member?.name})})]}),e("span",{className:"shrink-0 text-xs text-gray-400",children:[n?.progress?.done," / ",n?.progress?.total]})]}),e("span",{className:`absolute inset-0 ${a?"bg-green-100 group-hover:bg-green-200":"bg-gray-100 group-hover:bg-gray-200"}`,style:{width:`${n?.progress?.done/n?.progress?.total*100}%`}})]},n?.member._id):null}),r.length>4&&!g&&e("button",{onClick:()=>p(!0),className:"text-sm text-gray-400 underline",children:["+ ",r.length-4," more"]}),g&&e("button",{onClick:()=>p(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),r.length===0&&e("div",{className:"text-sm text-gray-500",children:"No progress"})]})]})]})}const ce=[{label:"Members",value:"member"},{label:"Roadmaps",value:"roadmap"}];function je(){const{teamId:c}=Q(),{gb:r}=O(),[d,u]=h(!0),l=F(),f=re(te),g=R(),[p,i]=h([]),[s,b]=h(r||"member");async function w(){const{response:a,error:y}=await Y(`https://api.roadmap.sh/v1-get-team-progress/${c}`);if(y||!a){l.error(y?.message||"Failed to get team progress");return}i(a.sort((C,N)=>C.email===g?.email?-1:N.email===g?.email?1:0))}if(T(()=>{c&&w().then(()=>{D.set(""),u(!1)})},[c]),d)return null;if(!c){window.location.href="/";return}T(()=>{s&&se({gb:s})},[s]);const n=[];for(const a of f?.roadmaps||[]){const y=[];for(const C of p){const N=C.progress.find(P=>P.resourceId===a);N&&y.push({member:C,progress:N})}y.length&&n.push({resourceId:a,resourceTitle:y?.[0].progress?.resourceTitle||"",resourceType:"roadmap",members:y})}return e("div",{children:[e("div",{className:"flex items-center gap-2",children:ce.map(a=>e("button",{className:`rounded-md border p-1 px-2 text-sm ${s===a.value?" border-gray-400 bg-gray-200 ":""}`,onClick:()=>b(a.value),children:a.label}))}),e("div",{className:"mt-6",children:[s==="roadmap"&&e("div",{className:"grid gap-4 sm:grid-cols-2",children:n.map(a=>e(ie,{roadmap:a},a.resourceId))}),s==="member"&&e("div",{className:"grid gap-4 sm:grid-cols-2",children:p.map(a=>e(le,{teamId:c,member:a,isMyProgress:a?.email===g?.email}))})]})]})}export{je as TeamProgressPage};
